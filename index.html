<!DOCTYPE html>
<html>
<head>
    <title>BlueGuard-Zero | Live Dashboard</title>
    <style>
        body { background: #0f172a; color: #38bdf8; font-family: 'Segoe UI', sans-serif; text-align: center; }
        .status-card { border: 2px solid #38bdf8; padding: 20px; display: inline-block; border-radius: 15px; margin-top: 50px; min-width: 320px; }
        .live-dot { height: 10px; width: 10px; background-color: #4ade80; border-radius: 50%; display: inline-block; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        #status { transition: color 0.5s ease; font-size: 24px; margin: 10px 0; }
        .info { font-size: 18px; color: #94a3b8; margin: 5px 0; }
        #proximity { font-weight: bold; color: #fbbf24; } /* Amber color for Proximity */
    </style>
</head>
<body>
    <h1>BLUEGUARD-ZERO MONITORING</h1>
    <div class="status-card">
        <div class="live-dot"></div> LIVE SYSTEM FEED
        <h2 id="status">CONNECTING TO PYTHON...</h2>
        <p class="info" id="rssi">RSSI: -- dBm</p>
        <p class="info">Proximity: <span id="proximity">Unknown</span></p>
    </div>

    <script>
        async function refreshData() {
            try {
                const response = await fetch('http://localhost:5000/data');
                const data = await response.json();

                const statusElement = document.getElementById('status');
                const proxElement = document.getElementById('proximity');
                const rssiElement = document.getElementById('rssi');

                // 1. Update the Status
                statusElement.innerText = data.status;
                if (data.status === "SAFE_PRESENT") {
                    statusElement.style.color = "#4ade80"; // Green
                } else if (data.status === "LOCK_TRIGGERED") {
                    statusElement.style.color = "#ff4444"; // Red
                } else {
                    statusElement.style.color = "#38bdf8"; // Blue (Connecting)
                }

                // 2. Update the RSSI and Proximity (New Fields)
                rssiElement.innerText = `RSSI: ${data.rssi} dBm`;
                proxElement.innerText = data.proximity;

            } catch (error) {
                document.getElementById('status').innerText = "OFFLINE (RUN PYTHON)";
                document.getElementById('status').style.color = "#64748b";
                document.getElementById('rssi').innerText = "RSSI: -- dBm";
                document.getElementById('proximity').innerText = "Unknown";
            }
        }

        setInterval(refreshData, 2000);
        refreshData();
    </script>
</body>
</html>